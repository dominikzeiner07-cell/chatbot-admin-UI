<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chatbot Admin – Wissen hochladen</title>
  <link rel="stylesheet" href="admin.css" />
  <script>
  window.ADMIN_UI_BACKEND_BASE = "https://chatbot-backend-iqma.onrender.com";
</script>
  <script src="admin.js" defer></script>
</head>
<body>
  <main class="page">
    <div class="admin-container">

      <nav class="tabs">
        <button class="tab-btn active" data-panel="panel-token">Admin-Token</button>
        <button class="tab-btn" data-panel="panel-customers">Customers</button>

        <!-- NEW -->
        <button class="tab-btn" data-panel="panel-widget">Widget</button>

        <button class="tab-btn" data-panel="panel-stats">Stats</button>
        <button class="tab-btn" data-panel="panel-answers">Antworten</button>
        <button class="tab-btn" data-panel="panel-upload">Dokument hochladen</button>
        <button class="tab-btn" data-panel="panel-crawl">Website crawlen</button>
        <button class="tab-btn" data-panel="panel-domain">Domain crawlen</button>
        <button class="tab-btn" data-panel="panel-purge">Purge / Löschen</button>
      </nav>

      <section class="panels">

        <!-- Admin-Token -->
        <div class="card panel active" id="panel-token">
          <h2>Admin-Token</h2>
          <p class="sub">
            Dieses Token wird NUR lokal im Browser gespeichert und bei geschützten Requests als Header
            <code>X-Admin-Token</code> mitgesendet.
          </p>

          <div class="grid-2" style="gap:.5rem; align-items:center;">
            <input id="admin-token-input" type="password" placeholder="Token eingeben …"
              autocapitalize="off" spellcheck="false" style="width:100%;" />
            <div style="display:flex; gap:.5rem; justify-content:flex-start;">
              <button id="save-admin-token" class="btn" type="button">Token speichern</button>
              <button id="clear-admin-token" class="btn" type="button">Token löschen</button>
            </div>
          </div>
          <div id="admin-token-hint" class="status info" aria-live="polite" style="margin-top:.5rem;"></div>
        </div>

        <!-- Customers -->
        <div class="card panel" id="panel-customers">
          <h2>Customers</h2>
          <p class="sub">
            Kunden verwalten (Plan/Model/Prompt/Domains/Limits).
          </p>

          <!-- NEW: Create Customer -->
          <div class="section">
            <h3>Neuen Customer erstellen</h3>

            <form id="cust_create_form" autocomplete="off" novalidate>
              <div class="grid-2">
                <div>
                  <label for="create_name">Name</label>
                  <input id="create_name" type="text" placeholder="z.B. Musterbetrieb GmbH" />
                </div>
                <div>
                  <label for="create_plan">Plan</label>
                  <select id="create_plan">
                    <option value="standard">standard</option>
                    <option value="pro">pro</option>
                  </select>
                </div>
              </div>

              <div class="grid-2">
                <div>
                  <label for="create_model">Model (Override, optional)</label>
                  <input id="create_model" type="text" placeholder="Optionaler Override (Default hängt vom Plan ab)" />
                  <div class="sub" id="create_model_hint" style="margin-top:6px;"></div>
                </div>
                <div>
                  <label for="create_ask_rpm">ask_rpm_limit (RPM, optional)</label>
                  <input id="create_ask_rpm" type="number" min="0" placeholder="leer = default" />
                </div>
              </div>

              <div class="grid-2">
                <div>
                  <label for="create_monthly_limit">monthly_message_limit (optional)</label>
                  <input id="create_monthly_limit" type="number" min="0" placeholder="leer = aus" />
                </div>
                <div>
                  <label for="create_allowed_domains">allowed_domains (optional)</label>
                  <textarea id="create_allowed_domains" rows="3" placeholder="Eine Domain pro Zeile, z.B.
example.com
sub.example.com"></textarea>
                </div>
              </div>

              <label for="create_system_prompt">system_prompt (optional)</label>
              <textarea id="create_system_prompt" rows="4" placeholder="Optionaler System-Prompt..."></textarea>

              <div style="display:flex; gap:.5rem; flex-wrap:wrap;">
                <button class="btn" id="cust_create_btn" type="button">Customer erstellen</button>
                <button class="btn btn-ghost" id="cust_create_clear" type="button">Felder leeren</button>
              </div>

              <div id="cust_create_status" class="status" aria-live="polite"></div>
            </form>
          </div>

          <div class="divider"></div>

          <!-- Select + Apply -->
          <div class="section">
            <h3>Customer auswählen</h3>
            <div class="grid-2" style="align-items:end;">
              <div>
                <label for="cust_search">Suche</label>
                <input id="cust_search" type="text" placeholder="Name oder ID …" />

                <label for="cust_select" style="margin-top:10px;">Customer</label>
                <select id="cust_select">
                  <option value="">– laden –</option>
                </select>
              </div>
              <div style="display:flex; gap:.5rem; flex-wrap:wrap;">
                <button class="btn" id="cust_refresh" type="button">Liste neu laden</button>
                <button class="btn btn-ghost" id="cust_apply_to_forms" type="button">In alle Tabs übernehmen</button>
              </div>
            </div>

            <div id="cust_load_status" class="status info" aria-live="polite"></div>
          </div>

          <div class="divider"></div>

          <!-- Edit -->
          <div class="section">
            <h3>Ausgewählter Customer bearbeiten</h3>

            <form id="cust_edit_form" autocomplete="off" novalidate>
              <div class="grid-2">
                <div>
                  <label for="cust_id">customer_id</label>
                  <input id="cust_id" type="text" readonly />
                </div>
                <div>
                  <label for="cust_name">Name</label>
                  <input id="cust_name" type="text" placeholder="z.B. Demo Kunde" />
                </div>
              </div>

              <div class="grid-3">
                <div>
                  <label for="cust_plan">Plan</label>
                  <select id="cust_plan">
                    <option value="">(leer)</option>
                    <option value="standard">standard</option>
                    <option value="pro">pro</option>
                  </select>
                </div>

                <div>
                  <label for="cust_model">Model (Override, optional)</label>
                  <input id="cust_model" type="text" placeholder="Optionaler Override (Default hängt vom Plan ab)" />
                  <div class="sub" id="cust_model_hint" style="margin-top:6px;"></div>
                </div>

                <div>
                  <label for="cust_widget_key">widget_key</label>
                  <input id="cust_widget_key" type="text" readonly />
                  <div class="hint-row">
                    <button class="btn btn-ghost" id="cust_regen_widget_key" type="button">
                      Widget-Key neu generieren
                    </button>
                  </div>
                </div>
              </div>

              <div class="grid-3">
                <div>
                  <label for="cust_monthly_limit">monthly_message_limit</label>
                  <input id="cust_monthly_limit" type="number" min="0" placeholder="leer = aus" />
                </div>

                <div>
                  <label for="cust_ask_rpm_limit">ask_rpm_limit (RPM)</label>
                  <input id="cust_ask_rpm_limit" type="number" min="0" placeholder="leer = default" />
                </div>

                <div>
                  <label for="cust_allowed_domains">allowed_domains</label>
                  <textarea id="cust_allowed_domains" rows="3" placeholder="Eine Domain pro Zeile, z.B.
example.com
sub.example.com"></textarea>
                </div>
              </div>

              <label for="cust_system_prompt">system_prompt</label>
              <textarea id="cust_system_prompt" rows="6" placeholder="Optionaler System-Prompt..."></textarea>

              <div style="display:flex; gap:.5rem; flex-wrap:wrap;">
                <button class="btn" id="cust_save" type="button">Änderungen speichern</button>
              </div>

              <div id="cust_edit_status" class="status" aria-live="polite"></div>
            </form>
          </div>
        </div>

        <!-- NEW: Widget Customize -->
        <div class="card panel" id="panel-widget">
          <h2>Widget</h2>
          <p class="sub">
            Widget-Design & Texte pro Customer anpassen (Avatar, Farben, Begrüßungen).
            (Logik + Speichern bauen wir als nächstes in <code>admin.js</code>.)
          </p>

          <div class="section" style="margin-bottom:12px;">
            <h3>Customer auswählen</h3>

            <div class="grid-2" style="align-items:end;">
              <div>
                <label for="widget_pick_search">Suche</label>
                <input id="widget_pick_search" type="text" placeholder="Name oder ID …" />

                <label for="widget_pick_select" style="margin-top:10px;">Customer</label>
                <select id="widget_pick_select">
                  <option value="">– auswählen –</option>
                </select>
              </div>

              <div style="display:flex; gap:.5rem; flex-wrap:wrap;">
                <button class="btn btn-ghost" id="widget_pick_use_current" type="button">
                  Vom Customers-Tab übernehmen
                </button>
              </div>
            </div>

            <div class="grid-2" style="align-items:end; margin-top:10px;">
              <div>
                <label for="widget_customer_id">customer_id</label>
                <input id="widget_customer_id" type="text" readonly placeholder="–" />
              </div>
              <div>
                <label for="widget_widget_key">widget_key</label>
                <input id="widget_widget_key" type="text" readonly placeholder="–" />
              </div>
            </div>

            <div id="widget_load_status" class="status info" aria-live="polite"></div>
          </div>

          <!-- MOVED HERE: Widget Snippet -->
          <div class="divider"></div>

          <div class="section">
            <h3>Widget-Snippet</h3>

            <div style="display:flex; gap:.5rem; flex-wrap:wrap;">
              <button class="btn" id="widget_copy_snippet" type="button">Widget-Snippet kopieren</button>
            </div>

            <details style="margin-top:10px;">
              <summary>Snippet Vorschau</summary>
              <pre id="widget_snippet_preview" class="pre"></pre>
            </details>

            <div id="widget_snippet_status" class="status" aria-live="polite"></div>
          </div>

          <div class="divider"></div>

          <div class="section">
            <h3>Texte</h3>

            <div class="grid-2">
              <div>
                <label for="widget_bot_name">Chatbot-Name (Header)</label>
                <input id="widget_bot_name" type="text" placeholder="z.B. Support Bot" />
              </div>
              <div>
                <label for="widget_user_label">User-Label (optional)</label>
                <input id="widget_user_label" type="text" placeholder="z.B. Du / Kunde / Ich" />
              </div>
            </div>

            <label for="widget_greeting_text">Launcher-Text (Bubble)</label>
            <textarea id="widget_greeting_text" rows="2" placeholder='z.B. "Ich bin hier, falls du Hilfe benötigst!"'></textarea>

            <label for="widget_first_message">Erste automatische Nachricht (im Chat)</label>
            <textarea id="widget_first_message" rows="2" placeholder='z.B. "Hallo! Wie kann ich helfen?"'></textarea>
          </div>

          <div class="divider"></div>

          <div class="section">
            <h3>Farben</h3>

            <div class="grid-3" style="align-items:end;">
              <div>
                <label for="widget_header_color">Header-Farbe</label>
                <div class="color-picker-row">
                  <span id="widget_header_color_swatch" class="color-swatch" aria-hidden="true"></span>
                  <input id="widget_header_color" type="color" value="#000000" />
                  <input id="widget_header_color_hex" class="color-hex" type="text" value="#000000"
                    readonly autocapitalize="off" spellcheck="false" />
                </div>
              </div>

              <div>
                <label for="widget_accent_color">Accent (Send-Button / Icons)</label>
                <div class="color-picker-row">
                  <span id="widget_accent_color_swatch" class="color-swatch" aria-hidden="true"></span>
                  <input id="widget_accent_color" type="color" value="#000000" />
                  <input id="widget_accent_color_hex" class="color-hex" type="text" value="#000000"
                    readonly autocapitalize="off" spellcheck="false" />
                </div>
              </div>

              <div>
                <label for="widget_text_color_mode">Text-Farbe (Auto)</label>
                <select id="widget_text_color_mode">
                  <option value="auto" selected>auto (empfohlen)</option>
                  <option value="light">hell</option>
                  <option value="dark">dunkel</option>
                </select>
              </div>
            </div>

            <p class="sub" style="margin-top:8px;">
              Hinweis: „Auto“ bedeutet: wir setzen die Textfarbe später automatisch so, dass sie auf dem Header gut lesbar ist.
            </p>
          </div>

          <div class="divider"></div>

          <div class="section">
            <h3>Profilbild (Bot-Avatar)</h3>
            <p class="sub" style="margin-top:-6px;">
              Professionell: Upload in Supabase Storage, pro Customer speicherbar. Wenn kein Bild gesetzt ist, nutzt das Widget den Default-Avatar.
            </p>

            <div class="grid-2" style="align-items:end;">
              <div>
                <label for="widget_avatar_file">Bild auswählen</label>
                <input id="widget_avatar_file" type="file" accept="image/*" />
              </div>
              <div style="display:flex; gap:.5rem; flex-wrap:wrap;">
                <button class="btn" id="widget_avatar_upload" type="button">Avatar hochladen</button>
                <button class="btn btn-ghost" id="widget_avatar_clear" type="button">Avatar entfernen</button>
              </div>
            </div>

            <div style="display:flex; gap:12px; align-items:center; margin-top:10px;">
              <div class="sub" style="min-width:120px;">Vorschau:</div>
              <img id="widget_avatar_preview" alt="Avatar Vorschau" style="width:44px;height:44px;border-radius:999px;object-fit:cover;border:1px solid rgba(0,0,0,0.12);display:none;" />
              <div id="widget_avatar_preview_fallback" class="sub" style="color:#6b7280;">(kein Avatar gesetzt)</div>
            </div>
          </div>

          <div class="divider"></div>

          <div class="section">
            <h3>Speichern</h3>
            <div style="display:flex; gap:.5rem; flex-wrap:wrap;">
              <button class="btn" id="widget_save" type="button">Widget-Settings speichern</button>
              <button class="btn btn-ghost" id="widget_reset_defaults" type="button">Auf Defaults zurücksetzen</button>
            </div>

            <details style="margin-top:10px;">
              <summary>Raw JSON (Widget Settings)</summary>
              <pre id="widget_raw" class="pre"></pre>
            </details>

            <div id="widget_status" class="status" aria-live="polite"></div>
          </div>
        </div>

        <!-- Stats -->
        <div class="card panel" id="panel-stats">
          <h2>Stats</h2>
          <p class="sub">
            Interaction-Stats: Totals + Daily Breakdown.
          </p>

          <div class="section" style="margin-bottom:12px;">
            <h3>Scope / Customer auswählen</h3>

            <div class="grid-2" style="align-items:end;">
              <div>
                <label for="stats_pick_search">Suche</label>
                <input id="stats_pick_search" type="text" placeholder="Name oder ID …" />

                <label for="stats_pick_select" style="margin-top:10px;">Customer (für „Selected Customer“)</label>
                <select id="stats_pick_select">
                  <option value="">– auswählen –</option>
                </select>
              </div>

              <div style="display:flex; gap:.5rem; flex-wrap:wrap;">
                <button class="btn btn-ghost" id="stats_pick_use_current" type="button">Vom Customers-Tab übernehmen</button>
              </div>
            </div>

            <div class="grid-2" style="align-items:end; margin-top:10px;">
              <div>
                <label for="stats_days">Zeitraum (Tage)</label>
                <input id="stats_days" type="number" min="1" max="365" value="7" />
              </div>
              <div style="display:flex; gap:.5rem; flex-wrap:wrap;">
                <button class="btn" id="stats_all" type="button">Alle Customers</button>
                <button class="btn btn-ghost" id="stats_selected" type="button">Selected Customer</button>
              </div>
            </div>

            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-label">Total</div>
                <div class="stat-value" id="stat_total">–</div>
              </div>
              <div class="stat-card">
                <div class="stat-label">Allowed</div>
                <div class="stat-value" id="stat_allowed">–</div>
              </div>
              <div class="stat-card">
                <div class="stat-label">Blocked</div>
                <div class="stat-value" id="stat_blocked">–</div>
              </div>
            </div>

            <details style="margin-top:10px;">
              <summary>Raw JSON (Totals)</summary>
              <pre id="stats_raw" class="pre"></pre>
            </details>

            <div id="stats_status" class="status" aria-live="polite"></div>
          </div>

          <div class="divider"></div>

          <div class="section">
            <h3>Daily Stats</h3>
            <p class="sub" style="margin-top:-6px;">
              Pro Tag: total / allowed / blocked.
            </p>

            <div class="table-wrap">
              <table class="table">
                <thead>
                  <tr>
                    <th>Datum</th>
                    <th style="text-align:right;">Total</th>
                    <th style="text-align:right;">Allowed</th>
                    <th style="text-align:right;">Blocked</th>
                  </tr>
                </thead>
                <tbody id="daily_body">
                  <tr><td colspan="4" style="color:#6b7280;">–</td></tr>
                </tbody>
              </table>
            </div>

            <details style="margin-top:10px;">
              <summary>Raw JSON (Daily)</summary>
              <pre id="daily_raw" class="pre"></pre>
            </details>

            <div id="daily_status" class="status" aria-live="polite"></div>
          </div>
        </div>

        <!-- Antworten -->
        <div class="card panel" id="panel-answers">
          <h2>Antworten</h2>
          <p class="sub">
            Hier siehst du die letzten Fragen & Antworten (Interaktionen) aus dem System.
          </p>

          <div class="section" style="margin-bottom:12px;">
            <h3>Scope / Customer auswählen</h3>

            <div class="grid-2" style="align-items:end;">
              <div>
                <label for="answers_pick_search">Suche</label>
                <input id="answers_pick_search" type="text" placeholder="Name oder ID …" />

                <label for="answers_pick_select" style="margin-top:10px;">Customer</label>
                <select id="answers_pick_select">
                  <option value="">– auswählen –</option>
                </select>
              </div>

              <div style="display:flex; gap:.5rem; flex-wrap:wrap;">
                <button class="btn btn-ghost" id="answers_pick_use_current" type="button">Vom Customers-Tab übernehmen</button>
              </div>
            </div>

            <div class="grid-3" style="align-items:end; margin-top:10px;">
              <div>
                <label for="answers_days">Zeitraum (Tage)</label>
                <input id="answers_days" type="number" min="1" max="365" value="7" />
              </div>
              <div>
                <label for="answers_limit">Limit</label>
                <input id="answers_limit" type="number" min="1" max="500" value="50" />
              </div>
              <div>
                <label for="answers_query">Suche im Text (optional)</label>
                <input id="answers_query" type="text" placeholder="z.B. Rückgabe, Öffnungszeiten, …" />
              </div>
            </div>

            <div style="display:flex; gap:.5rem; flex-wrap:wrap; margin-top:10px;">
              <button class="btn" id="answers_load_all" type="button">Alle Customers</button>
              <button class="btn btn-ghost" id="answers_load_selected" type="button">Selected Customer</button>
            </div>

            <div id="answers_status" class="status" aria-live="polite"></div>
          </div>

          <div class="divider"></div>

          <div class="section">
            <h3>Letzte Interaktionen</h3>

            <div class="table-wrap">
              <table class="table">
                <thead>
                  <tr>
                    <th style="min-width:140px;">Zeit</th>
                    <th style="min-width:220px;">Customer</th>
                    <th>Frage</th>
                    <th>Antwort</th>
                    <th style="text-align:right; min-width:90px;">Status</th>
                  </tr>
                </thead>
                <tbody id="answers_body">
                  <tr><td colspan="5" style="color:#6b7280;">–</td></tr>
                </tbody>
              </table>
            </div>

            <details style="margin-top:10px;">
              <summary>Raw JSON (Antworten)</summary>
              <pre id="answers_raw" class="pre"></pre>
            </details>
          </div>
        </div>

        <!-- Upload -->
        <div class="card panel" id="panel-upload">
          <h1>Wissens-Dokument hochladen</h1>
          <p class="sub">
            Dieses Formular sendet Inhalte an dein Backend (<code>/ingest</code>) und speichert sie in Supabase.
          </p>

          <div class="section" style="margin-bottom:12px;">
            <h3>Customer auswählen</h3>
            <div class="grid-2" style="align-items:end;">
              <div>
                <label for="pick_upload_search">Suche</label>
                <input id="pick_upload_search" type="text" placeholder="Name oder ID …" />

                <label for="pick_upload_select" style="margin-top:10px;">Customer</label>
                <select id="pick_upload_select">
                  <option value="">– auswählen –</option>
                </select>
              </div>
              <div class="sub" style="margin-top:22px;">
                Auswahl füllt <code>customer_id</code> automatisch aus.
              </div>
            </div>
          </div>

          <form id="upload-form" autocomplete="off" novalidate>
            <label for="customer_id">customer_id</label>
            <input id="customer_id" name="customer_id" type="text" value="demo-1" required autocapitalize="off" spellcheck="false" />

            <label for="content">Inhalt / FAQ / Öffnungszeiten</label>
            <textarea id="content" name="content" rows="6" required placeholder="z.B.&#10;Montag–Freitag 9–18 Uhr&#10;Samstag 10–14 Uhr&#10;Sonntag geschlossen" autocapitalize="off" spellcheck="false"></textarea>

            <label for="metadata">Metadata (optional, JSON)</label>
            <textarea id="metadata" name="metadata" rows="3" placeholder='{"url":"https://example.com/faq"}' autocapitalize="off" spellcheck="false"></textarea>

            <button type="submit" class="btn">Speichern</button>
            <div id="status" class="status" aria-live="polite"></div>
          </form>
        </div>

        <!-- Crawl -->
        <div class="card panel" id="panel-crawl">
          <h2>Website crawlen (eine URL)</h2>
          <p class="sub">
            Holt den Inhalt einer einzelnen Seite über dein Backend (<code>/crawl</code>) und speichert Text-Chunks.
          </p>

          <div class="section" style="margin-bottom:12px;">
            <h3>Customer auswählen</h3>
            <div class="grid-2" style="align-items:end;">
              <div>
                <label for="pick_crawl_search">Suche</label>
                <input id="pick_crawl_search" type="text" placeholder="Name oder ID …" />

                <label for="pick_crawl_select" style="margin-top:10px;">Customer</label>
                <select id="pick_crawl_select">
                  <option value="">– auswählen –</option>
                </select>
              </div>
              <div class="sub" style="margin-top:22px;">
                Auswahl füllt <code>customer_id</code> automatisch aus.
              </div>
            </div>
          </div>

          <form id="crawl-form" autocomplete="off" novalidate>
            <label for="crawl_customer_id">customer_id</label>
            <input id="crawl_customer_id" type="text" value="demo-1" required autocapitalize="off" spellcheck="false" />

            <label for="crawl_url">URL</label>
            <input id="crawl_url" type="url" placeholder="https://www.dein-kunde.at/leistungen" required autocapitalize="off" spellcheck="false" />

            <button type="submit" class="btn">Seite crawlen</button>
            <div id="crawl-status" class="status" aria-live="polite"></div>
          </form>
        </div>

        <!-- Domain -->
        <div class="card panel" id="panel-domain">
          <h2>Domain crawlen (mehrere Seiten)</h2>
          <p class="sub">
            Startet beim Einstiegspunkt und folgt internen Links (BFS) – gefiltert, mit Rate-Limit.
            Nutzt den Endpoint <code>/crawl-domain</code>.
          </p>

          <div class="section" style="margin-bottom:12px;">
            <h3>Customer auswählen</h3>
            <div class="grid-2" style="align-items:end;">
              <div>
                <label for="pick_domain_search">Suche</label>
                <input id="pick_domain_search" type="text" placeholder="Name oder ID …" />

                <label for="pick_domain_select" style="margin-top:10px;">Customer</label>
                <select id="pick_domain_select">
                  <option value="">– auswählen –</option>
                </select>
              </div>
              <div class="sub" style="margin-top:22px;">
                Auswahl füllt <code>customer_id</code> automatisch aus.
              </div>
            </div>
          </div>

          <form id="domain-form" autocomplete="off" novalidate>
            <label for="dom_customer_id">customer_id</label>
            <input id="dom_customer_id" type="text" value="demo-1" required autocapitalize="off" spellcheck="false" />

            <label for="dom_start_url">Start-URL (Domain-Einstieg)</label>
            <input id="dom_start_url" type="url" placeholder="https://www.dein-kunde.at/" required autocapitalize="off" spellcheck="false" />

            <div class="grid-2">
              <div>
                <label for="dom_max_pages">Max. Seiten</label>
                <input id="dom_max_pages" type="number" min="1" max="250" value="40" />
              </div>
              <div>
                <label for="dom_max_depth">Max. Tiefe</label>
                <input id="dom_max_depth" type="number" min="1" max="6" value="2" />
              </div>
            </div>

            <div class="grid-2">
              <div>
                <label for="dom_delay_ms">Delay zwischen Requests (ms)</label>
                <input id="dom_delay_ms" type="number" min="0" max="5000" value="300" />
              </div>
              <div class="checkboxes">
                <label class="checkbox"><input id="dom_same_origin" type="checkbox" checked /><span>Nur gleiche Origin</span></label>
                <label class="checkbox"><input id="dom_respect_robots" type="checkbox" checked /><span>robots.txt respektieren</span></label>
              </div>
            </div>

            <button type="submit" class="btn">Domain crawlen</button>
            <div id="domain-status" class="status" aria-live="polite"></div>
          </form>
        </div>

        <!-- Purge -->
        <div class="card panel" id="panel-purge">
          <h2>Purge / Löschen</h2>
          <p class="sub">
            Purge löscht Dokumente (<code>/purge</code>). Darunter kannst du den gesamten Customer inkl. Daten löschen (<code>/admin/customers/:id</code>).
          </p>

          <div class="section" style="margin-bottom:12px;">
            <h3>Customer auswählen</h3>
            <div class="grid-2" style="align-items:end;">
              <div>
                <label for="pick_purge_search">Suche</label>
                <input id="pick_purge_search" type="text" placeholder="Name oder ID …" />

                <label for="pick_purge_select" style="margin-top:10px;">Customer</label>
                <select id="pick_purge_select">
                  <option value="">– auswählen –</option>
                </select>
              </div>
              <div class="sub" style="margin-top:22px;">
                Auswahl füllt <code>customer_id</code> automatisch aus.
              </div>
            </div>
          </div>

          <!-- Purge documents -->
          <form id="purge-form" autocomplete="off" novalidate>
            <h3>Purge: Wissens-Index (documents) löschen</h3>

            <label for="purge_customer_id">customer_id</label>
            <input id="purge_customer_id" type="text" value="demo-3" required autocapitalize="off" spellcheck="false" />

            <label for="purge_prefix">Source-Prefix (optional)</label>
            <input id="purge_prefix" type="url" placeholder="z. B. https://domain.tld/faq/" autocapitalize="off" spellcheck="false" />

            <div class="checkboxes" style="margin-top:4px;">
              <label class="checkbox" style="display:block;">
                <input id="purge_all" type="checkbox" />
                <span>Ohne Prefix ALLES für diesen Kunden löschen (Bestätigung)</span>
              </label>
            </div>

            <div style="display:flex; gap:.5rem; flex-wrap:wrap;">
              <button id="purge_btn_dry" type="button" class="btn">Dry-Run ausführen</button>
              <button id="purge_btn_go" type="button" class="btn" style="background:#b91c1c;">Jetzt löschen</button>
            </div>

            <div id="purge-status" class="status" aria-live="polite"></div>
          </form>

          <div class="divider"></div>

          <!-- Delete customer -->
          <form id="customer-delete-form" autocomplete="off" novalidate>
            <h3>Customer löschen (Danger Zone)</h3>
            <p class="sub" style="margin-top:-6px;">
              Löscht den Customer und optional dessen <code>documents</code> und <code>interactions</code>.
              Empfehlung: erst Dry-Run.
            </p>

            <div class="checkboxes" style="margin-top:4px;">
              <label class="checkbox" style="display:block;margin-bottom:6px;">
                <input id="custdel_docs" type="checkbox" checked />
                <span>documents löschen</span>
              </label>
              <label class="checkbox" style="display:block;margin-bottom:6px;">
                <input id="custdel_interactions" type="checkbox" checked />
                <span>interactions löschen</span>
              </label>
              <label class="checkbox" style="display:block;margin-bottom:6px;">
                <input id="custdel_confirm" type="checkbox" />
                <span>Ich bestätige: Customer wirklich löschen</span>
              </label>
            </div>

            <div style="display:flex; gap:.5rem; flex-wrap:wrap;">
              <button id="custdel_btn_dry" type="button" class="btn">Dry-Run (Counts)</button>
              <button id="custdel_btn_go" type="button" class="btn" style="background:#b91c1c;">Customer löschen</button>
            </div>

            <div id="custdel_status" class="status" aria-live="polite"></div>
          </form>
        </div>

      </section>
    </div>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const tabs = document.querySelectorAll('.tab-btn');
      const panels = document.querySelectorAll('.panel');

      tabs.forEach((btn) => {
        btn.addEventListener('click', () => {
          const targetId = btn.getAttribute('data-panel');
          if (!targetId) return;

          tabs.forEach((b) => b.classList.remove('active'));
          panels.forEach((p) => p.classList.remove('active'));

          btn.classList.add('active');
          const panel = document.getElementById(targetId);
          if (panel) panel.classList.add('active');
        });
      });
    });
  </script>
</body>
</html>